<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>sample-src/easeljs/display/BitmapText.js - CreateJS API</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body>

<div id="doc">
    <div id="hd" class="header">
        <div class="project-title">
            
                <img class="logo" src="https://d3oaxc4q5k2d6q.cloudfront.net/m/5c85e8398db4/img/language-avatars/actionscript_64.png" title="CreateJS API">
            
            
                <h1 class="project-name">CreateJS API</h1> <span class="project-version">0.7.0</span>
            
        </div>
    </div>
    <div id="bd" class="">

        <div id="docs-sidebar" class="sidebar apidocs">
            <div id="api-list">
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a class="type" href="../classes/AlphaMapFilter.html">AlphaMapFilter</a></li>
            
                <li><a class="type" href="../classes/AlphaMaskFilter.html">AlphaMaskFilter</a></li>
            
                <li><a class="type" href="../classes/Bitmap.html">Bitmap</a></li>
            
                <li><a class="type" href="../classes/BitmapAnimation.html">BitmapAnimation</a></li>
            
                <li><a class="type" href="../classes/BitmapText.html">BitmapText</a></li>
            
                <li><a class="type" href="../classes/BlurFilter.html">BlurFilter</a></li>
            
                <li><a class="type" href="../classes/ButtonHelper.html">ButtonHelper</a></li>
            
                <li><a class="type" href="../classes/ColorFilter.html">ColorFilter</a></li>
            
                <li><a class="type" href="../classes/ColorMatrix.html">ColorMatrix</a></li>
            
                <li><a class="type" href="../classes/ColorMatrixFilter.html">ColorMatrixFilter</a></li>
            
                <li><a class="type" href="../classes/Command.html">Command</a></li>
            
                <li><a class="type" href="../classes/Container.html">Container</a></li>
            
                <li><a class="type" href="../classes/DisplayObject.html">DisplayObject</a></li>
            
                <li><a class="type" href="../classes/DOMElement.html">DOMElement</a></li>
            
                <li><a class="type" href="../classes/EaselJS.html">EaselJS</a></li>
            
                <li><a class="type" href="../classes/Event.html">Event</a></li>
            
                <li><a class="type" href="../classes/EventDispatcher.html">EventDispatcher</a></li>
            
                <li><a class="type" href="../classes/Filter.html">Filter</a></li>
            
                <li><a class="type" href="../classes/Graphics.html">Graphics</a></li>
            
                <li><a class="type" href="../classes/Matrix2D.html">Matrix2D</a></li>
            
                <li><a class="type" href="../classes/MouseEvent.html">MouseEvent</a></li>
            
                <li><a class="type" href="../classes/MovieClip.html">MovieClip</a></li>
            
                <li><a class="type" href="../classes/MovieClipPlugin.html">MovieClipPlugin</a></li>
            
                <li><a class="type" href="../classes/Point.html">Point</a></li>
            
                <li><a class="type" href="../classes/Rectangle.html">Rectangle</a></li>
            
                <li><a class="type" href="../classes/Shadow.html">Shadow</a></li>
            
                <li><a class="type" href="../classes/Shape.html">Shape</a></li>
            
                <li><a class="type" href="../classes/Sprite.html">Sprite</a></li>
            
                <li><a class="type" href="../classes/SpriteSheet.html">SpriteSheet</a></li>
            
                <li><a class="type" href="../classes/SpriteSheetBuilder.html">SpriteSheetBuilder</a></li>
            
                <li><a class="type" href="../classes/SpriteSheetUtils.html">SpriteSheetUtils</a></li>
            
                <li><a class="type" href="../classes/Stage.html">Stage</a></li>
            
                <li><a class="type" href="../classes/Text.html">Text</a></li>
            
                <li><a class="type" href="../classes/Ticker.html">Ticker</a></li>
            
                <li><a class="type" href="../classes/Touch.html">Touch</a></li>
            
                <li><a class="type" href="../classes/UID.html">UID</a></li>
            
                <li><a class="type" href="../classes/Utility Methods.html">Utility Methods</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a class="module" href="../modules/CreateJS.html">CreateJS</a></li>
            
                <li><a class="module" href="../modules/EaselJS.html">EaselJS</a></li>
            
            </ul>
        </div>
    </div>
</div>

        </div>

        <div id="docs-main" class="apidocs">
            <div class="content container">
                <h1 class="file-heading">File: sample-src/easeljs/display/BitmapText.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
* BitmapText
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2010 gskinner.com, inc.
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the &quot;Software&quot;), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/

this.createjs = this.createjs || {};

(function () {
	&quot;use strict&quot;;

/**
 * Displays text using bitmap glyphs defined in a sprite sheet. Multi-line text is supported
 * using new line characters, but automatic wrapping is not supported. See the 
 * {{#crossLink &quot;BitmapText/spriteSheet:attribute&quot;}}{{/crossLink}}
 * property for more information on defining glyphs.
 * @class BitmapText
 * @extends DisplayObject
 * @param {String} [text=&quot;&quot;] The text to display.
 * @param {SpriteSheet} [spriteSheet=null] The spritesheet that defines the character glyphs.
 * @constructor
 **/
function BitmapText(text, spriteSheet) {
	this.initialize(text, spriteSheet);
}
var p = BitmapText.prototype = new createjs.DisplayObject();

// static properties:

// events:

// public properties:
	/**
	 * The text to display.
	 * @property text
	 * @type String
	 * @default &quot;&quot;
	 **/
	p.text = &quot;&quot;;
	
	/**
	 * A SpriteSheet instance that defines the glyphs for this bitmap text. Each glyph/character
	 * should have a single frame animation defined in the sprite sheet named the same as
	 * corresponding character. For example, the following animation definition:
	 *
	 * 		&quot;A&quot;: {frames: [0]}
	 *
	 * would indicate that the frame at index 0 of the spritesheet should be drawn for the &quot;A&quot; character. The short form
	 * is also acceptable:
	 * 
	 * 		&quot;A&quot;: 0
	 *
	 * Note that if a character in the text is not found in the sprite sheet, it will also
	 * try to use the alternate case (upper or lower).
	 *
	 * See SpriteSheet for more information on defining sprite sheet data.
	 * @property spriteSheet
	 * @type String
	 * @default null
	 **/
	p.spriteSheet = null;

	/**
	 * The height of each line of text. If 0, then it will use a line height calculated
	 * by checking for the height of the &quot;1&quot;, &quot;T&quot;, or &quot;L&quot; character (in that order). If
	 * those characters are not defined, it will use the height of the first frame of the
	 * sprite sheet.
	 * @property lineHeight
	 * @type Number
	 * @default 0
	 **/
	p.lineHeight = 0;

	/**
	 * This spacing (in pixels) will be added after each character in the output.
	 * @property letterSpacing
	 * @type Number
	 * @default 0
	 **/
	p.letterSpacing = 0;

	/**
	 * If a space character is not defined in the sprite sheet, then empty pixels equal to
	 * spaceWidth will be inserted instead. If  0, then it will use a value calculated
	 * by checking for the width of the &quot;1&quot;, &quot;E&quot;, or &quot;A&quot; character (in that order). If
	 * those characters are not defined, it will use the width of the first frame of the
	 * sprite sheet.
	 * @property spaceWidth
	 * @type Number
	 * @default 0
	 **/
	p.spaceWidth = 0;
	
// private properties:
	
// constructor:
	/**
	 * @property DisplayObject_initialize
	 * @type Function
	 * @protected
	 **/
	p.DisplayObject_initialize = p.initialize;
	
	/**
	 * Initialization method.
	 * @method initialize
	 * @param {String} [text=&quot;&quot;] The text to display.
	 * @param {SpriteSheet} [spriteSheet=null] The spritesheet that defines the character glyphs.
	 * @protected
	 **/
	p.initialize = function (text, spriteSheet) {
		this.DisplayObject_initialize();

		this.text = text;
		this.spriteSheet = spriteSheet;
	};
	
// public methods:
	/**
	 * @property DisplayObject_draw
	 * @type Function
	 * @protected
	 **/
	p.DisplayObject_draw = p.draw;
	
	/**
	 * Draws the display object into the specified context ignoring it&#x27;s visible, alpha, shadow, and transform.
	 * Returns true if the draw was handled (useful for overriding functionality).
	 * NOTE: This method is mainly for internal use, though it may be useful for advanced uses.
	 * @method draw
	 * @param {CanvasRenderingContext2D} ctx The canvas 2D context object to draw into.
	 * @param {Boolean} ignoreCache Indicates whether the draw operation should ignore any current cache.
	 * For example, used for drawing the cache (to prevent it from simply drawing an existing cache back
	 * into itself).
	 **/
	p.draw = function(ctx, ignoreCache) {
		if (this.DisplayObject_draw(ctx, ignoreCache)) { return true; }
		this._drawText(ctx);
	};
	
	/**
	 * Returns true or false indicating whether the display object would be visible if drawn to a canvas.
	 * This does not account for whether it would be visible within the boundaries of the stage.
	 * NOTE: This method is mainly for internal use, though it may be useful for advanced uses.
	 * @method isVisible
	 * @return {Boolean} Boolean indicating whether the display object would be visible if drawn to a canvas
	 **/
	p.isVisible = function() {
		var hasContent = this.cacheCanvas || (this.spriteSheet &amp;&amp; this.spriteSheet.complete &amp;&amp; this.text);
		return !!(this.visible &amp;&amp; this.alpha &gt; 0 &amp;&amp; this.scaleX != 0 &amp;&amp; this.scaleY != 0 &amp;&amp; hasContent);
	};
	
	/**
	 * Docced in superclass.
	 */
	p.getBounds = function() {
		var bounds = this._rectangle;
		this._drawText(null, bounds);
		return bounds.width ? bounds : null;
	};

// private methods:
	/**
	 * @method _getFrame
	 * @param {String} character
	 * @param {SpriteSheet} spriteSheet
	 * @protected
	 **/
	p._getFrame = function(character, spriteSheet) {
		var c, o = spriteSheet.getAnimation(character);
		if (!o) {
			(character != (c = character.toUpperCase())) || (character != (c = character.toLowerCase())) || (c=null);
			if (c) { o = spriteSheet.getAnimation(c); }
		}
		return o &amp;&amp; spriteSheet.getFrame(o.frames[0]);
	};
	
	/**
	 * @method _getLineHeight
	 * @param {SpriteSheet} ss
	 * @protected
	 **/
	p._getLineHeight = function(ss) {
		var frame = this._getFrame(&quot;1&quot;,ss) || this._getFrame(&quot;T&quot;,ss) || this._getFrame(&quot;L&quot;,ss) || ss.getFrame(0);
		return frame ? frame.rect.height : 1;
	};
	
	/**
	 * @method _getSpaceWidth
	 * @param {SpriteSheet} ss
	 * @protected
	 **/
	p._getSpaceWidth = function(ss) {
		var frame = this._getFrame(&quot;1&quot;,ss) || this._getFrame(&quot;l&quot;,ss) || this._getFrame(&quot;e&quot;,ss) || this._getFrame(&quot;a&quot;,ss) || ss.getFrame(0);
		return frame ? frame.rect.width : 1;
	};
	
	/**
	 * @method _drawText
	 * @param {CanvasRenderingContext2D} ctx
	 * @param {Object | Rectangle} bounds
	 * @protected
	 **/
	p._drawText = function(ctx, bounds) {
		var w, h, rx, x=0, y=0, spaceW=this.spaceWidth, lineH=this.lineHeight, ss=this.spriteSheet;
				
		var hasSpace = !!this._getFrame(&quot; &quot;, ss);
		if (!hasSpace &amp;&amp; spaceW==0) { spaceW = this._getSpaceWidth(ss); }
		if (lineH==0) { lineH = this._getLineHeight(ss); }
		
		var maxX = 0;
		for(var i=0, l=this.text.length; i&lt;l; i++) {
			var character = this.text.charAt(i);
			if (!hasSpace &amp;&amp; character == &quot; &quot;) {
				x += spaceW;
				continue;
			} else if (character==&quot;\n&quot; || character==&quot;\r&quot;) {
				if (character==&quot;\r&quot; &amp;&amp; this.text.charAt(i+1) == &quot;\n&quot;) { i++; } // crlf
				if (x-rx &gt; maxX) { maxX = x-rx; }
				x = 0;
				y += lineH;
				continue;
			}

			var o = this._getFrame(character, ss);
			if (!o) { continue; }
			var rect = o.rect;
			rx = o.regX;
			w = rect.width;
			ctx&amp;&amp;ctx.drawImage(o.image, rect.x, rect.y, w, h=rect.height, x-rx, y-o.regY, w, h);
			
			x += w + this.letterSpacing;
		}
		if (x-rx &gt; maxX) { maxX = x-rx; }
		
		if (bounds) {
			bounds.width = maxX-this.letterSpacing;
			bounds.height = y+lineH;
		}
	};

	createjs.BitmapText = BitmapText;
}());
    </pre>
</div>

            </div>
        </div>

    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
