<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>sample-src/easeljs/utils/SpriteSheetUtils.js - CreateJS API</title>
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="../assets/vendor/yui-min.js"></script>
</head>
<body>

<div id="doc">
    <header class="main-header">
        <div class="content">
            <div class="project-title">
                
                    <img class="logo" src="https://d3oaxc4q5k2d6q.cloudfront.net/m/5c85e8398db4/img/language-avatars/actionscript_64.png" title="CreateJS API">
                
                
                    <h1 class="project-name">CreateJS API</h1> <span class="project-version">0.7.0</span>
                
                
                    <p class="description">A JavaScript API that brings Flash&#x27;s display list to HTML canvas.</p>
                
            </div>
            <ul class="jump-links">
                <li><a href="#index" class="index-jump-link">&uarr; index</a></li>
                <li><a href="#top" class="top-jump-link">&uarr; top</a></li>
            </ul>
        </div>
    </header>
    <div class="main-body">

        <div id="docs-sidebar" class="sidebar apidocs">
            <div id="api-list">
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a class="type" href="../classes/AlphaMapFilter.html">AlphaMapFilter</a></li>
            
                <li><a class="type" href="../classes/AlphaMaskFilter.html">AlphaMaskFilter</a></li>
            
                <li><a class="type" href="../classes/Bitmap.html">Bitmap</a></li>
            
                <li><a class="type" href="../classes/BitmapAnimation.html">BitmapAnimation</a></li>
            
                <li><a class="type" href="../classes/BitmapText.html">BitmapText</a></li>
            
                <li><a class="type" href="../classes/BlurFilter.html">BlurFilter</a></li>
            
                <li><a class="type" href="../classes/ButtonHelper.html">ButtonHelper</a></li>
            
                <li><a class="type" href="../classes/ColorFilter.html">ColorFilter</a></li>
            
                <li><a class="type" href="../classes/ColorMatrix.html">ColorMatrix</a></li>
            
                <li><a class="type" href="../classes/ColorMatrixFilter.html">ColorMatrixFilter</a></li>
            
                <li><a class="type" href="../classes/Command.html">Command</a></li>
            
                <li><a class="type" href="../classes/Container.html">Container</a></li>
            
                <li><a class="type" href="../classes/DisplayObject.html">DisplayObject</a></li>
            
                <li><a class="type" href="../classes/DOMElement.html">DOMElement</a></li>
            
                <li><a class="type" href="../classes/EaselJS.html">EaselJS</a></li>
            
                <li><a class="type" href="../classes/Event.html">Event</a></li>
            
                <li><a class="type" href="../classes/EventDispatcher.html">EventDispatcher</a></li>
            
                <li><a class="type" href="../classes/Filter.html">Filter</a></li>
            
                <li><a class="type" href="../classes/Graphics.html">Graphics</a></li>
            
                <li><a class="type" href="../classes/Matrix2D.html">Matrix2D</a></li>
            
                <li><a class="type" href="../classes/MouseEvent.html">MouseEvent</a></li>
            
                <li><a class="type" href="../classes/MovieClip.html">MovieClip</a></li>
            
                <li><a class="type" href="../classes/MovieClipPlugin.html">MovieClipPlugin</a></li>
            
                <li><a class="type" href="../classes/Point.html">Point</a></li>
            
                <li><a class="type" href="../classes/Rectangle.html">Rectangle</a></li>
            
                <li><a class="type" href="../classes/Shadow.html">Shadow</a></li>
            
                <li><a class="type" href="../classes/Shape.html">Shape</a></li>
            
                <li><a class="type" href="../classes/Sprite.html">Sprite</a></li>
            
                <li><a class="type" href="../classes/SpriteSheet.html">SpriteSheet</a></li>
            
                <li><a class="type" href="../classes/SpriteSheetBuilder.html">SpriteSheetBuilder</a></li>
            
                <li><a class="type" href="../classes/SpriteSheetUtils.html">SpriteSheetUtils</a></li>
            
                <li><a class="type" href="../classes/Stage.html">Stage</a></li>
            
                <li><a class="type" href="../classes/Text.html">Text</a></li>
            
                <li><a class="type" href="../classes/Ticker.html">Ticker</a></li>
            
                <li><a class="type" href="../classes/Touch.html">Touch</a></li>
            
                <li><a class="type" href="../classes/UID.html">UID</a></li>
            
                <li><a class="type" href="../classes/Utility Methods.html">Utility Methods</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a class="module" href="../modules/CreateJS.html">CreateJS</a></li>
            
                <li><a class="module" href="../modules/EaselJS.html">EaselJS</a></li>
            
            </ul>
        </div>
    </div>
</div>

        </div>

        <div id="docs-main" class="apidocs">
            <div class="content container">
                <h1 class="file-heading">File: sample-src/easeljs/utils/SpriteSheetUtils.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/*
* SpriteSheetUtils
* Visit http://createjs.com/ for documentation, updates and examples.
*
* Copyright (c) 2010 gskinner.com, inc.
*
* Permission is hereby granted, free of charge, to any person
* obtaining a copy of this software and associated documentation
* files (the &quot;Software&quot;), to deal in the Software without
* restriction, including without limitation the rights to use,
* copy, modify, merge, publish, distribute, sublicense, and/or sell
* copies of the Software, and to permit persons to whom the
* Software is furnished to do so, subject to the following
* conditions:
*
* The above copyright notice and this permission notice shall be
* included in all copies or substantial portions of the Software.
*
* THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND,
* EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES
* OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
* NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT
* HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,
* WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
* FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR
* OTHER DEALINGS IN THE SOFTWARE.
*/

/**
 * @module EaselJS
 */

// namespace:
this.createjs = this.createjs||{};

(function() {
	&quot;use strict&quot;;
// constructor:
/**
 * The SpriteSheetUtils class is a collection of static methods for working with {{#crossLink &quot;SpriteSheet&quot;}}{{/crossLink}}s.
 * A sprite sheet is a series of images (usually animation frames) combined into a single image on a regular grid. For
 * example, an animation consisting of 8 100x100 images could be combined into a 400x200 sprite sheet (4 frames across
 * by 2 high). The SpriteSheetUtils class uses a static interface and should not be instantiated.
 * @class SpriteSheetUtils
 * @static
 **/
var SpriteSheetUtils = function() {
	throw &quot;SpriteSheetUtils cannot be instantiated&quot;;
};

	/**
	 * @property _workingCanvas
	 * @static
	 * @type HTMLCanvasElement | Object
	 * @protected
	*/
	
	/**
	 * @property _workingContext
	 * @static
	 * @type CanvasRenderingContext2D
	 * @protected
	*/
	var canvas = (createjs.createCanvas?createjs.createCanvas():document.createElement(&quot;canvas&quot;));
	if (canvas.getContext) {
		SpriteSheetUtils._workingCanvas = canvas;
		SpriteSheetUtils._workingContext = canvas.getContext(&quot;2d&quot;);
		canvas.width = canvas.height = 1;
	}

	

// public static methods:
	/**
	 * &lt;b&gt;This is an experimental method, and may be buggy. Please report issues.&lt;/b&gt;&lt;br/&gt;&lt;br/&gt;
	 * Extends the existing sprite sheet by flipping the original frames horizontally, vertically, or both,
	 * and adding appropriate animation &amp; frame data. The flipped animations will have a suffix added to their names
	 * (_h, _v, _hv as appropriate). Make sure the sprite sheet images are fully loaded before using this method.
	 * &lt;br/&gt;&lt;br/&gt;
	 * For example:&lt;br/&gt;
	 * SpriteSheetUtils.addFlippedFrames(mySpriteSheet, true, true);
	 * The above would add frames that are flipped horizontally AND frames that are flipped vertically.
	 * &lt;br/&gt;&lt;br/&gt;
	 * Note that you can also flip any display object by setting its scaleX or scaleY to a negative value. On some
	 * browsers (especially those without hardware accelerated canvas) this can result in slightly degraded performance,
	 * which is why addFlippedFrames is available.
	 * @method addFlippedFrames
	 * @static
	 * @param {SpriteSheet} spriteSheet
	 * @param {Boolean} horizontal If true, horizontally flipped frames will be added.
	 * @param {Boolean} vertical If true, vertically flipped frames will be added.
	 * @param {Boolean} both If true, frames that are flipped both horizontally and vertically will be added.
	 * @deprecated Modern browsers perform better when flipping via a transform (ex. scaleX=-1) rendering this obsolete.
	 **/
	SpriteSheetUtils.addFlippedFrames = function(spriteSheet, horizontal, vertical, both) {
		if (!horizontal &amp;&amp; !vertical &amp;&amp; !both) { return; }

		var count = 0;
		if (horizontal) { SpriteSheetUtils._flip(spriteSheet,++count,true,false); }
		if (vertical) { SpriteSheetUtils._flip(spriteSheet,++count,false,true); }
		if (both) { SpriteSheetUtils._flip(spriteSheet,++count,true,true); }
	};

	/**
	 * Returns a single frame of the specified sprite sheet as a new PNG image. An example of when this may be useful is
	 * to use a spritesheet frame as the source for a bitmap fill.
	 *
	 * &lt;strong&gt;WARNING:&lt;/strong&gt; In almost all cases it is better to display a single frame using a {{#crossLink &quot;Sprite&quot;}}{{/crossLink}}
	 * with a {{#crossLink &quot;Sprite/gotoAndStop&quot;}}{{/crossLink}} call than it is to slice out a frame using this
	 * method and display it with a Bitmap instance. You can also crop an image using the {{#crossLink &quot;Bitmap/sourceRect&quot;}}{{/crossLink}}
	 * property of {{#crossLink &quot;Bitmap&quot;}}{{/crossLink}}.
	 *
	 * The extractFrame method may cause cross-domain warnings since it accesses pixels directly on the canvas.
	 * @method extractFrame
	 * @static
	 * @param {Image} spriteSheet The SpriteSheet instance to extract a frame from.
	 * @param {Number|String} frameOrAnimation The frame number or animation name to extract. If an animation
	 * name is specified, only the first frame of the animation will be extracted.
	 * @return {Image} a single frame of the specified sprite sheet as a new PNG image.
	*/
	SpriteSheetUtils.extractFrame = function(spriteSheet, frameOrAnimation) {
		if (isNaN(frameOrAnimation)) {
			frameOrAnimation = spriteSheet.getAnimation(frameOrAnimation).frames[0];
		}
		var data = spriteSheet.getFrame(frameOrAnimation);
		if (!data) { return null; }
		var r = data.rect;
		var canvas = SpriteSheetUtils._workingCanvas;
		canvas.width = r.width;
		canvas.height = r.height;
		SpriteSheetUtils._workingContext.drawImage(data.image, r.x, r.y, r.width, r.height, 0, 0, r.width, r.height);
		var img = document.createElement(&quot;img&quot;);
		img.src = canvas.toDataURL(&quot;image/png&quot;);
		return img;
	};

	/**
	 * Merges the rgb channels of one image with the alpha channel of another. This can be used to combine a compressed
	 * JPEG image containing color data with a PNG32 monochromatic image containing alpha data. With certain types of
	 * images (those with detail that lend itself to JPEG compression) this can provide significant file size savings
	 * versus a single RGBA PNG32. This method is very fast (generally on the order of 1-2 ms to run).
	 * @method mergeAlpha
	 * @static
	 * @param {Image} rbgImage The image (or canvas) containing the RGB channels to use.
	 * @param {Image} alphaImage The image (or canvas) containing the alpha channel to use.
	 * @param {Canvas} canvas Optional. If specified, this canvas will be used and returned. If not, a new canvas will be created.
	 * @return {Canvas} A canvas with the combined image data. This can be used as a source for Bitmap or SpriteSheet.
	 * @deprecated Tools such as ImageAlpha generally provide better results. This will be moved to sandbox in the future.
	*/
	SpriteSheetUtils.mergeAlpha = function(rgbImage, alphaImage, canvas) {
		if (!canvas) { canvas = createjs.createCanvas?createjs.createCanvas():document.createElement(&quot;canvas&quot;); }
		canvas.width = Math.max(alphaImage.width, rgbImage.width);
		canvas.height = Math.max(alphaImage.height, rgbImage.height);
		var ctx = canvas.getContext(&quot;2d&quot;);
		ctx.save();
		ctx.drawImage(rgbImage,0,0);
		ctx.globalCompositeOperation = &quot;destination-in&quot;;
		ctx.drawImage(alphaImage,0,0);
		ctx.restore();
		return canvas;
	};


// private static methods:
	SpriteSheetUtils._flip = function(spriteSheet, count, h, v) {
		var imgs = spriteSheet._images;
		var canvas = SpriteSheetUtils._workingCanvas;
		var ctx = SpriteSheetUtils._workingContext;
		var il = imgs.length/count;
		for (var i=0;i&lt;il;i++) {
			var src = imgs[i];
			src.__tmp = i; // a bit hacky, but faster than doing indexOf below.
			ctx.setTransform(1,0,0,1,0,0);
			ctx.clearRect(0,0,canvas.width+1,canvas.height+1);
			canvas.width = src.width;
			canvas.height = src.height;
			ctx.setTransform(h?-1:1, 0, 0, v?-1:1, h?src.width:0, v?src.height:0);
			ctx.drawImage(src,0,0);
			var img = document.createElement(&quot;img&quot;);
			img.src = canvas.toDataURL(&quot;image/png&quot;);
			// work around a strange bug in Safari:
			img.width = src.width;
			img.height = src.height;
			imgs.push(img);
		}

		var frames = spriteSheet._frames;
		var fl = frames.length/count;
		for (i=0;i&lt;fl;i++) {
			src = frames[i];
			var rect = src.rect.clone();
			img = imgs[src.image.__tmp+il*count];

			var frame = {image:img,rect:rect,regX:src.regX,regY:src.regY};
			if (h) {
				rect.x = img.width-rect.x-rect.width; // update rect
				frame.regX = rect.width-src.regX; // update registration point
			}
			if (v) {
				rect.y = img.height-rect.y-rect.height;  // update rect
				frame.regY = rect.height-src.regY; // update registration point
			}
			frames.push(frame);
		}

		var sfx = &quot;_&quot;+(h?&quot;h&quot;:&quot;&quot;)+(v?&quot;v&quot;:&quot;&quot;);
		var names = spriteSheet._animations;
		var data = spriteSheet._data;
		var al = names.length/count;
		for (i=0;i&lt;al;i++) {
			var name = names[i];
			src = data[name];
			var anim = {name:name+sfx,speed:src.speed,next:src.next,frames:[]};
			if (src.next) { anim.next += sfx; }
			frames = src.frames;
			for (var j=0,l=frames.length;j&lt;l;j++) {
				anim.frames.push(frames[j]+fl*count);
			}
			data[anim.name] = anim;
			names.push(anim.name);
		}
	};


createjs.SpriteSheetUtils = SpriteSheetUtils;
}());

    </pre>
</div>

            </div>
        </div>

    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/vendor/jquery.min.js"></script>
<script src="../assets/js/jquery-ks-scroll-styles.js"></script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
<script src="../assets/js/main.js"></script>
</body>
</html>
